function init(){aG={},lmG={},lmG.legendLayers=[],require(["esri/config","mesa/base","dojo/text!./scripts/_config/config.json"],function(esriConfig,base,JSONconfig){JSONconfig=JSON.parse(JSONconfig),aG.popup=setPopup(1===checkForMobile()?"mobile":"static"),esriConfig.defaults.io.proxyUrl=JSONconfig.proxyURL,esriConfig.defaults.io.alwaysUseProxy=!1,esriConfig.defaults.geometryService=createGeometryService(JSONconfig.geometryService),document.dojoClick=!1;var utm12=setSpatialRef(102206),initExtent=setInitialExtent(utm12);aG.map=createMap(initExtent),aG.pTemp=createPopupTemplate(),lmG.pLay=createFeatureLayer("http://mcmap2.mesacounty.us/arcgis/rest/services/maps/ParcelOnly4Query/MapServer/0"),lmG.roadLabels=createTiledMapServiceLayer("http://mcmap2.mesacounty.us/arcgis/rest/services/maps/parcel_road_labels/MapServer","roadLabels"),lmG.vectorBasemap=createTiledMapServiceLayer("http://mcmap2.mesacounty.us/arcgis/rest/services/maps/vector_basemap/MapServer","vectorBasemap");var initialBasemap=lmG.vectorBasemap;aG.map.addLayers([lmG.vectorBasemap,lmG.roadLabels,lmG.pLay]),aG.map.on("load",function(){createScalebar(aG.map),createContextMenu(aG.map,JSONconfig.geometryService),createLegend(aG.map,aG.popup.domNode.id),createHomeButton(aG.map),setEventHandlers(JSONconfig,aG.map,lmG.pLay,initialBasemap,lmG.roadLabels,aG.popup,aG.pTemp),document.getElementById("loading").style.display="none",aG.map.disableKeyboardNavigation(),location.href.indexOf("?")>-1&&urlMapType(location.href,aG.map,aG.popup,aG.pTemp)})})}function setEventHandlers(JSONconfig,map,parcelLayerObject,initialBasemap,roadLabelsObject,popupObject,popupTemplateObject){require(["dojo/on","dojo/query","dojo/dom","dojo/touch"],function(on,query,dom,touch){window.addEventListener("orientationchange",orientationChanged,!1),map.on("mouse-move",function(e){showCoords(e,"screenCoordinatesUTM")}),on(dom.byId("toolSelect"),"click",function(){runToolsView(JSONconfig.geometryService,JSONconfig.printURL,map)}),on(dom.byId("help"),touch.release,function(e){showHelp(e,JSONconfig.printURL)}),on(dom.byId("shareMap"),touch.release,function(){showShareForm(map)}),on(query("#DTLegend, #legendDialog > .dialogHeader > .dialogCloser"),touch.release,function(){toggleDialog("legendDialog")}),on(query("#DTprint"),touch.release,function(){showPrinter(map,JSONconfig.printURL)}),on(query("#DTbookmarks"),touch.release,function(){showBookmarks(map)}),on(query("#DTqueryatts"),touch.release,function(){showQuery(map,JSONconfig.geometryService)}),on(query("#DTmeasure"),touch.release,function(){showMeasure(map,parcelLayerObject,JSONconfig.geometryService)}),on(query("#DTbasemap,#IPbasemap"),touch.release,function(){showBasemap(map,JSONconfig.imagesList,initialBasemap)}),on(query(".shareClass, #sharebutton"),touch.release,function(){showShare("socialShare")}),on(query("#layerSelect ul li"),touch.release,function(e){themeClick(e,this,map,popupObject,popupTemplateObject)}),on(query(".plus"),touch.release,clickPlus),on(query(".baselyrs"),"click",function(e){baseLayersSwitch(e,parcelLayerObject,initialBasemap,roadLabelsObject)}),on(dom.byId("hidePanel"),"click",animatePanel),on(dom.byId("locate"),touch.release,function(){showLocator(map,JSONconfig.geometryService)}),on(query(".submen li, .submenu li"),touch.release,function(){var classname="."+this.parentNode.className;query(classname)[0].style.display="none"}),on(query("#combobox, #mainfish"),"mouseenter, mouseleave, touchstart",function(e){var display="mouseleave"===e.type?"none":"block",classname="."+query("#"+this.id+" ul")[0].className;query(classname)[0].style.display=display}),on(query("#searchLI ul li"),touch.release,function(e){e.stopPropagation();var type=this.getAttribute("data-value");dom.byId("searchLI").childNodes[0].nodeValue=this.childNodes[0].innerHTML,require(["dijit/registry"],function(registry){registry.byId("searchFieldDialog")&&registry.byId("searchFieldDialog").destroyRecursive(),searchBy(map,type,void 0,"desktop")})})})}function createTiledMapServiceLayer(url,id){var tile;return require(["esri/layers/ArcGISTiledMapServiceLayer"],function(ArcGISTiledMapServiceLayer){tile=new ArcGISTiledMapServiceLayer(url,{id:id})}),tile}function createFeatureLayer(url){var service;return require(["esri/layers/FeatureLayer"],function(FeatureLayer){service=new FeatureLayer(url,{mode:FeatureLayer.MODE_ONDEMAND,infoTemplate:aG.pTemp,outFields:["LOCATION","ACCOUNTNO","OWNER","JTOWNER","SDATE","PARCEL_NUM","ZONING","Acres","JURISDICTION"]})}),service}function createGeometryService(serviceURL){var service;return require(["esri/tasks/GeometryService"],function(GeometryService){service=new GeometryService(serviceURL)}),service}function createPopupTemplate(){var temp;return require(["esri/dijit/PopupTemplate"],function(PopupTemplate){temp=new PopupTemplate({fieldInfos:[{fieldName:"Acres",visible:!0,format:{places:2}}],title:"<b>Parcel Information:</b>",description:"<b>Account number:</b>  <a href='http://emap.mesacounty.us/assessor_lookup/Assessor_Parcel_Report.aspx?Account={ACCOUNTNO}'target='_blank'>{ACCOUNTNO}</a><br><b>Parcel Number:</b> {PARCEL_NUM}<br><b>Owner:</b>  {OWNER}<br><b>Joint Owner:</b>  {JTOWNER}<br><b>Address:</b>{LOCATION}<br><b>Sale Date:</b> {SDATE}<br><b>Zoning:</b> {ZONING}<br><b>Approximate Acres:</b> {Acres}<br><b>Jurisdiction: </b>{JURISDICTION}<br><div id='mapButtons'><a title='Click to view parcel in Google Earth' class='maplink' target='_blank' href='http://emap.mesacounty.us/kmls?acct={ACCOUNTNO}'>Google Earth</a><a title='Click to view parcel in Bing Maps' class='maplink' target='_blank' href='http://www.bing.com/maps/?mapurl=http://emap.mesacounty.us/kmls?acct={ACCOUNTNO}'>Bing Maps</a></div><br>"})}),temp}function createMap(initExtent){var map;return require(["esri/map"],function(Map){map=new Map("map",{extent:initExtent,logo:!1,infoWindow:aG.popup})}),map}function setInitialExtent(spatialRef){var ext;return require(["esri/geometry/Extent"],function(Extent){ext=new Extent({xmin:685960,ymin:4316261,xmax:738288,ymax:4342506,spatialReference:spatialRef})}),ext}function setSpatialRef(wkid){var ref;return require(["esri/SpatialReference"],function(SpatialReference){ref=new SpatialReference({wkid:wkid})}),ref}function setPopup(type){var pop;return"mobile"===type?require(["dojo/dom","esri/dijit/PopupMobile"],function(dom,PopupMobile){pop=PopupMobile(null,dom.byId("popup"))}):require(["esri/dijit/Popup"],function(Popup){pop=Popup({titleInBody:!1},document.getElementById("popup"))}),pop}function checkForMobile(){var isMobile;return require(["dojo/has","dojo/sniff"],function(has,sniff){has.add("mobile",function(global,document,anElement){return has("ie")?void require(["libs/matchMedia"],function(){return!(!window.matchMedia("only screen and (max-width: 1024px)").matches||!has("touch"))}):!(!window.matchMedia("only screen and (max-width: 1024px)").matches||!has("touch"))}),isMobile=has("mobile")?1:0}),isMobile}function runToolsView(geometryService,printURL,map){require(["dijit/registry","mesa/toolsWidget"],function(registry,toolsWidget){if(registry.byId("toolsView"))registry.byId("toolsView").domNode.style.display="block",query("#map_zoom_slider, #hidePanel, #rightPanel, .collapsedPanel").style("display","none");else{var tools=new toolsWidget({geometryServiceURL:geometryService,printURL:printURL,mapRef:map},"toolsView");tools.startup(),query("#map_zoom_slider, #hidePanel, #rightPanel, .collapsedPanel").style("display","none")}})}function orientationChanged(){require(["dojo/query"],function(query){query(".expandedPanel")[0].style.display="none"})}function showShare(id){document.getElementById(id).style.display="block"===document.getElementById(id).style.display?"none":"block"}function makeBoxesMoveable(){require(["dojo/dnd/move","dojo/query","dojo/dom"],function(move,query,dom){for(i=0,len=query(".moveableDialog");i<len.length;i++)move.parentConstrainedMoveable(dom.byId(len[i].id),{handle:query("#"+len[i].id+" > header"),area:"margin",within:!0});new move.parentConstrainedMoveable(dom.byId("popup"),{handle:dom.byId("popup"),area:"margin",within:!0})})}function createHomeButton(map){require(["mesa/homeButton"],function(homeButton){homeButton({mapRef:map})})}function createContextMenu(map,geometryServiceConfig){require(["mesa/contextMenuWidget"],function(contextMenuWidget){contextMenuWidget({mapRef:map,geometryServiceURL:geometryServiceConfig.geometryService,trsURL:"http://mcmap2.mesacounty.us/arcgis/rest/services/maps/eSurveyor/MapServer/26"})})}function createImageList(imageConfig){require(["esri/layers/ArcGISTiledMapServiceLayer"],function(ArcGISTiledMapServiceLayer){for(var x in imageConfig.images)lmG[imageConfig.images[x].imageId]=new ArcGISTiledMapServiceLayer(imageConfig.mapFolder+imageConfig.images[x].serviceName+imageConfig.serverType,{id:imageConfig.images[x].imageId})})}function createScalebar(map){require(["esri/dijit/Scalebar"],function(Scalebar){new Scalebar({map:map,attachTo:"bottom-right",scalebarUnit:"dual"})})}function createLegend(map,device){lmG.legendLayers.push({layer:lmG.vectorBasemap,title:"Basemap Layers",hideLayers:[7,12,17,22,23,24,25,26,27,28,32,35,36,37,38,39,50,51]}),require(["esri/dijit/Legend"],function(Legend){lmG.legend=new Legend({map:map,layerInfos:lmG.legendLayers},"legendDiv"),lmG.legend.startup()}),"popup"===device&&(toggleDialog("legendDialog"),makeBoxesMoveable())}function toggleDialog(dialogId){require(["dojo/dom","dojo/dom-class"],function(dom,domClass){domClass.contains(dom.byId("legendDialog"),"displayNo")?(dom.byId("legendDialog").style.display="block",domClass.remove(dom.byId("legendDialog"),"displayNo")):(dom.byId("legendDialog").style.display="none",domClass.add(dom.byId("legendDialog"),"displayNo"))})}function showPrinter(map,printURL){require(["mesa/printWidget","dojo/dom-construct","dojo/dom","dojo/on","dijit/registry","dojo/dom-style"],function(printWidget,domConstruct,dom,on,registry,domStyle){if(!registry.byId("printDialog2")){var printer=new printWidget({printUrl:printURL,mapRef:map,device:"desktop"},"printDialog2");printer.startup()}domStyle.set(dom.byId("printDialog2"),{display:"block"===domStyle.get(dom.byId("printDialog2"),"display")?"none":"block"})})}function showBookmarks(map){require(["dijit/registry","mesa/bookmarkWidget","dojo/dom"],function(registry,bookmarkWidget,dom){if(!registry.byId("bookmarkDialog2")){var bookmarks=new bookmarkWidget({mapRef:map},"bookmarkDialog2");bookmarks.startup()}dom.byId("bookmarkDialog2")&&(dom.byId("bookmarkDialog2").style.display="block"===dom.byId("bookmarkDialog2").style.display?"none":"block")})}function showHelp(e,printURL){e.preventDefault(),require(["mesa/helpWidget","dojo/dom-construct","dojo/dom","dojo/on","dijit/registry","dojo/dom-style"],function(helpWidget,domConstruct,dom,on,registry,domStyle){if(dom.byId("helpMenu2")&&!registry.byId("helpMenu2")){var help=new helpWidget({printUrl:printURL,device:"desktop"},"helpMenu2");help.startup()}dom.byId("helpMenu2")&&domStyle.set(dom.byId("helpMenu2"),{display:"block"===domStyle.get(dom.byId("helpMenu2"),"display")?"none":"block"})})}function showQuery(map,geometryServiceURL){require(["dojo/dom","dijit/registry","mesa/queryWidget"],function(dom,registry,queryWidget){if(dom.byId("queryDialog2")&&!registry.byId("queryDialog2")){var queryTool=new queryWidget({device:"desktop",mapRef:map,geometryServiceURL:geometryServiceURL,exportURL:"scripts/php/toCSV.php",csvOutputLocation:"scripts/php/"},"queryDialog2");queryTool.startup()}dom.byId("queryDialog2")&&(dom.byId("queryDialog2").style.display="block"===dom.byId("queryDialog2").style.display?"none":"block")})}function showBasemap(map,imageConfig,initialBasemap){require(["dijit/registry","mesa/basemapWidget"],function(registry){registry.byId("imagelist2")?registry.byId("imagelist2")&&lmG.imageTool.basemapChanger():(createImageList(imageConfig),lmG.imageTool=new basemapWidget({mapRef:map,device:"desktop",initialBasemap:initialBasemap},"imagelist2"),lmG.imageTool.startup(),lmG.imageTool.basemapChanger())})}function showShareForm(map){require(["mesa/shareFormWidget","dijit/registry","dojo/dom"],function(shareFormWidget,registry,dom){if(!registry.byId("shareForm2")){var shareForm=new shareFormWidget({emailServiceUrl:"scripts/php/ShareMail.php",mapRef:map},"shareForm2");shareForm.startup()}dom.byId("shareForm2")&&(dom.byId("shareForm2").style.display="block"===dom.byId("shareForm2").style.display?"none":"block")})}function showMeasure(map,parcelLayer,geometryService){require(["mesa/measureWidget","dojo/dom","dojo/on","dijit/registry"],function(measureWidget,dom,on,registry){if(dom.byId("measureDialog2")&&!registry.byId("measureDialog2")){var measure=new measureWidget({mapRef:map,gsvc:geometryService,device:"desktop",parcelLayer:parcelLayer},"measureDialog2");measure.startup()}dom.byId("measureDialog2")&&(dom.byId("measureDialog2").style.display="block"===dom.byId("measureDialog2").style.display?"none":"block")})}function showLocator(map,geometryService){require(["mesa/locatorWidget","dojo/dom","dojo/on","dijit/registry"],function(locatorWidget,dom,on,registry){var locate=new locatorWidget({mapRef:map,gsvc:geometryService,device:"desktop"});locate.startup()})}function searchBy(map,type,option,device,turnOff){var thisFunctionParam="noPoint",thisTargetGeometry="polygon",thisOutFields="LOCATION",thisService="ParcelOnly4Query/MapServer/0/query",thisType="Address";require(["mesa/searchCompleteWidget"],function(searchCompleteWidget){switch(type){case"address":thisTargetGeometry="point",thisService="ParcePointQuery/MapServer/0/query";break;case"intersection":thisFunctionParam="Intersection",thisTargetGeometry="point",thisOutFields="Intersection",thisService="roads_and_intersections/MapServer/0/query",thisType="Intersection";break;case"account":thisOutFields="ACCOUNTNO",thisType="Account";break;case"parcelNo":thisOutFields="PARCELNUM",thisType="Parcel Number";break;case"subdivision":thisOutFields="SUBNAME",thisService="eSurveyor/MapServer/13/query",thisType="Subdivision";break;case"place":thisFunctionParam="FEATURE_NAME",thisTargetGeometry="point",thisOutFields="FEATURE_NAME",thisService="PlaceNames/MapServer/0/query",thisType="Place Name";break;case"PLSS":thisOutFields="TRSM",thisService="eSurveyor/MapServer/26/query",thisType="Township/Range";break;case"Latitude/Longitude":thisFunctionParam="gcs",thisTargetGeometry="point",thisType="Latitude/Longitude";break;default:alert("This tool has not been implemented")}new searchCompleteWidget({device:device,mapRef:map,type:thisType,service:thisService,where:thisOutFields+" LIKE",outFields:thisOutFields,targetGeom:thisTargetGeometry,functionParam:thisFunctionParam,geometryServiceURL:esriConfig.defaults.geometryService,option:void 0!==option?option:void 0,turnOff:turnOff},"searchFieldDialog").startup()})}function showCoords(evt,id){document.getElementById(id).innerHTML="X="+evt.mapPoint.x.toFixed(1)+"  Y="+evt.mapPoint.y.toFixed(1)}function extentZoom(extentObject){var viewExtent;return require(["esri/geometry/Extent","esri/SpatialReference"],function(Extent,SpatialReference){var utm12=new SpatialReference({wkid:102206}),ext=extentObject.split(":"),xmini=parseInt(ext[0]),ymini=parseInt(ext[1]),xmaxi=parseInt(ext[2]),ymaxi=parseInt(ext[3]);viewExtent=new Extent({xmin:xmini,ymin:ymini,xmax:xmaxi,ymax:ymaxi,spatialReference:utm12})}),viewExtent}function baseLayersSwitch(e,ParcelLayerObject,basemapObject,roadLabelObject){require(["dojo/query","dojo/dom-attr"],function(query,domAttr){var target=e.target?e.target:e.srcElement,thisClassName=domAttr.get(target,"class");thisClassName="input."+thisClassName.split(" ").pop();var baselayers=query(".expand")[0],box=query(thisClassName),layers={"input.pclcbx":ParcelLayerObject,"input.lbsgcbx":basemapObject,"input.bgcbx":roadLabelObject};for(i=0;i<box.length;i++)box[i].checked=!!target.checked;if(baselayers.checked)for(var x in layers)query(x)[0].checked?layers[x].show():layers[x].hide();else for(var x in layers)layers[x].hide()})}function clickPlus(e){require(["dojo/query","dojo/dom-attr","dojo/dom-style","dojo/dom-class","dojo/NodeList-traverse","dojo/NodeList-manipulate"],function(query,domAttr,domStyle,domClass){var cls=domAttr.get(e.target,"class");cls=cls.split(" ")[1],"minus"!==cls?(query(".plus").forEach(function(node){domClass.replace(node,"minus","plus")}),query(".lyrexpand").children("li").forEach(function(node){domStyle.set(node,"display","block")})):(query(".plusSign").forEach(function(node){domClass.replace(node,"plus","minus")}),query(".lyrexpand").children("li").forEach(function(node){domStyle.set(node,"display","none")}))})}function urlMapType(url,map,infowindow,popupTemplate){require(["esri/urlUtils","dojo/query","dojo/NodeList-traverse","dojo/dom-attr","dojo/_base/array","dojo/NodeList-manipulate"],function(urlUtils,query,domAttr,array){function parseParameters(url){function createTitle(map_type){return query("#layerSelect ul li[data-value='"+map_type+"']").children("a").innerHTML()}function maptypeFound(type){return getTemplate(type),animatePanel("open"),type}function runQuery(layerid,field,value){require(["esri/tasks/QueryTask","esri/tasks/query","esri/graphic","mesa/graphicsTools"],function(QueryTask,Query,Graphic,graphicsTools){var graphicTool=new graphicsTools({geometryServiceURL:esriConfig.defaults.geometryService,mapRef:map});dQueryTask=new QueryTask("http://mcmap2.mesacounty.us/arcgis/rest/services/maps/"+service+"/MapServer/"+layerid),dQuery=new Query,dQuery.returnGeometry=!0,dQuery.outFields=[""],dQuery.where=field+" = '"+value+"'",dQueryTask.execute(dQuery,function(result){map.setExtent(map.graphics.add(new Graphic(graphicTool.createJSONPolygon(result.features[0].geometry.rings))).geometry.getExtent().expand(1.5))})})}var queryObject=urlUtils.urlToObject(url).query;if(queryObject){var maptype=queryObject.maptype?maptypeFound(queryObject.maptype.toLowerCase()):"",title=queryObject.maptype?createTitle(queryObject.maptype):"Select Map",layerid=queryObject.layerid?queryObject.layerid:"",checkboxid=queryObject.cbxid?queryObject.cbxid.toLowerCase().split(","):"",field=queryObject.field?String(queryObject.field).toUpperCase():"",value=queryObject.value?queryObject.value:"",service=queryObject.service?queryObject.service:"",coordinates=queryObject.latlon?queryObject.latlon:"",accountNumber=queryObject.ACCOUNTNO?queryObject.ACCOUNTNO.toUpperCase():"",parcelNumber=queryObject.PARCEL_NUM?queryObject.PARCEL_NUM.replace(/-/g,""):"",extent=queryObject.EXTENT?queryObject.EXTENT.toUpperCase():"",params=[maptype,title,layerid,value,checkboxid];""!==coordinates?searchBy(map,"Latitude/Longitude",coordinates):null,""!==field?runQuery(layerid,field,value):null,""!==accountNumber?searchBy(map,"account",accountNumber):null,""!==parcelNumber?searchBy(map,"parcelNo",parcelNumber):null,""!==extent?map.setExtent(extentZoom(extent)):null}return params}var urlParams=parseParameters(url);"Select Map"!==urlParams[1]&&require(["mesa/changeTheme","dojo/dom"],function(changeTheme,dom){setTimeout(function(){new changeTheme({newLayer:urlParams[0],layerTitle:urlParams[1],option:urlParams[2],pVal:urlParams[3],mapRef:map,infoWindowRef:infowindow,infoTemplateRef:popupTemplate,checkboxid:urlParams[4]})},200)})})}function getTemplate(newLayerName){var templateName="dojo/text!./scripts/esri/mesa/templates/"+newLayerName+"Select.html";document.getElementById(newLayerName+"Select")||require([templateName,"dojo/dom-construct","dojo/dom-attr","dojo/dom"],function(template,domConstruct,domAttr,dom){domConstruct.place(template,"noControl","before")})}function themeClick(e,node,map,popupObject,popupTemplateObject){e.stopPropagation();var newLayer=node.attributes["data-value"].nodeValue;if(getTemplate(newLayer),"epom"!==newLayer&&newLayer.length>0){var layerTitle=node.getElementsByTagName("a")[0].innerHTML,option=node.attributes["data-opt"]?node.attributes["data-opt"].nodeValue:null;setTimeout(function(){require(["mesa/changeTheme"],function(changeTheme){new changeTheme({newLayer:newLayer,layerTitle:layerTitle,option:option,pVal:null,mapRef:map,infoWindowRef:popupObject,infoTemplateRef:popupTemplateObject}).then(animatePanel(e))})},200)}}function animatePanel(e){require(["dojo/dom","dojo/query","dojo/dom-attr","dojo/dom-class","dojo/dom-style"],function(dom,query,domAttr,domClass,domStyle){if("open"===e)dom.byId("hidePanel").innerHTML="hide",dom.byId("noControl").style.display="block",domClass.replace(dom.byId("rightPanel"),"expandedPanel","collapsedPanel");else{var parentcls=domAttr.get(e.target.parentNode,"class");if(query(".select").every(function(node){return"none"===domStyle.get(node,"display")})?domClass.remove("noControl","someControl"):domClass.add("noControl","someControl"),"click"===e.type&&"collapsedPanel"===parentcls)dom.byId("hidePanel").innerHTML="hide",domClass.replace(dom.byId("rightPanel"),"expandedPanel","collapsedPanel");else if("click"===e.type&&"expandedPanel"===parentcls)dom.byId("hidePanel").innerHTML="Layers",domClass.replace(dom.byId("rightPanel"),"collapsedPanel","expandedPanel");else{if("A"!==e.target.nodeName&&"LI"!==e.target.nodeName)return;dom.byId("hidePanel").innerHTML="hide",domClass.replace(dom.byId("rightPanel"),"expandedPanel","collapsedPanel")}}})}init();