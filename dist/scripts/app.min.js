"use strict";function init(){require(["esri/config","dojo/on","dojo/dom-construct","dojo/text!./scripts/_config/config.json","esri/dijit/Legend","dojo/query","dojo/dom","dojo/touch","mesa/themeTools","dijit/registry","mesa/toolsWidget2","mesa/searchTools","esri/tasks/QueryTask","esri/graphic","mesa/graphicsTools","esri/urlUtils","dojo/dom-attr","dojo/_base/array","esri/geometry/Extent","esri/SpatialReference","mesa/locatorWidget","esri/dijit/Scalebar","mesa/contextMenuWidget","mesa/homeButton","dojo/has","dojo/sniff","esri/dijit/PopupMobile","esri/dijit/Popup","esri/map","esri/dijit/PopupTemplate","esri/tasks/GeometryService","esri/layers/FeatureLayer","esri/layers/ArcGISTiledMapServiceLayer","libs/matchMedia","dojo/NodeList-traverse","dojo/NodeList-manipulate"],function(esriConfig,on,domConstruct,JSONconfig,Legend,query,dom,touch,themeTools,registry,toolsWidget,searchTools,QueryTask,Graphic,graphicsTools,urlUtils,domAttr,array,Extent,SpatialReference,locatorWidget,Scalebar,contextMenuWidget,homeButton,has,sniff,PopupMobile,Popup,Map,PopupTemplate,GeometryService,FeatureLayer,ArcGISTiledMapServiceLayer){function showDropdownMenu(e,display){void 0===display?(display="mouseleave"===e.type?"none":"block",query("."+query("#"+e.currentTarget.id+" ul")[0].className)[0].style.display=display):query("."+e.currentTarget.parentNode.className)[0].style.display=display}function createTiledMapServiceLayer(url,id){return new ArcGISTiledMapServiceLayer(url,{id:id})}function createFeatureLayer(url,template,fields){return new FeatureLayer(url,{mode:FeatureLayer.MODE_ONDEMAND,infoTemplate:template,outFields:fields})}function createPopupTemplate(){return new PopupTemplate({fieldInfos:[{fieldName:"Acres",visible:!0,format:{places:2}}],title:"<b>Parcel Information:</b>",description:"<b>Account number:</b>  <a href='https://emap.mesacounty.us/assessor_lookup/Assessor_Parcel_Report.aspx?Account={ACCOUNTNO}'target='_blank'>{ACCOUNTNO}</a><br><b>Parcel Number:</b> {PARCEL_NUM}<br><b>Owner:</b>  {OWNER}<br><b>Joint Owner:</b>  {JTOWNER}<br><b>Address:</b>{LOCATION}<br><b>Sale Date:</b> {SDATE}<br><b>Zoning:</b> {ZONING}<br><b>Approximate Acres:</b> {Acres}<br><b>Jurisdiction: </b>{JURISDICTION}<br><div id='mapButtons'><a title='Click to view parcel in Google Earth' class='maplink' target='_blank' href='https://emap.mesacounty.us/kmls?acct={ACCOUNTNO}'>Google Earth</a><a title='Click to view parcel in Bing Maps' class='maplink' target='_blank' href='https://www.bing.com/maps/?mapurl=https://emap.mesacounty.us/kmls?acct={ACCOUNTNO}'>Bing Maps</a></div><br>"})}function createMap(initExtent,popup){return new Map("map",{extent:initExtent,logo:!1,infoWindow:popup})}function setInitialExtent(spatialReference,device){var xmin="mobile"===device?697373:685960,ymin="mobile"===device?4322305:4316261,xmax="mobile"===device?726312:738288,ymax="mobile"===device?4335072:4342506;return new Extent({xmin:xmin,ymin:ymin,xmax:xmax,ymax:ymax,spatialReference:spatialReference})}function setPopup(type,popupNode){return"mobile"===type?PopupMobile(null,dom.byId(popupNode)):Popup({titleInBody:!1},dom.byId(popupNode))}function checkForMobile(){return has.add("mobile",function(global,document,anElement){return has("ie")?!!window.matchMedia("only screen and (max-width: 1024px)").matches:!!window.matchMedia("only screen and (max-width: 1024px)").matches}),has("mobile")?1:0}function runToolsView(config,appConfig){var mapRef=appConfig.mapRef,deviceUsed=appConfig.deviceUsed,popupRef=appConfig.popupRef,popupTemplateRef=appConfig.popupTemplateRef,legendRef=appConfig.legendRef,basemap=appConfig.basemap,parcelLayer=appConfig.parcelLayer;registry.byId("toolsView2")?"block"===registry.byId("toolsView2").domNode.style.display?registry.byId("toolsView2").domNode.style.display="none":registry.byId("toolsView2").domNode.style.display="block":(new toolsWidget({geometryServiceURL:config.geometryService,printURL:config.printURL,imageList:config.imagesList,mapRef:mapRef,basemap:basemap,deviceUsed:deviceUsed,popupRef:popupRef,popupTemplateRef:popupTemplateRef,legendRef:legendRef,parcelLayer:parcelLayer},"toolsView2"),registry.byId("toolsView2").domNode.style.display="none")}function orientationChanged(){query(".expandedPanel")[0]&&(query(".expandedPanel")[0].style.display="none")}function createContextMenu(mapRef,geometryServiceURL){contextMenuWidget({mapRef:mapRef,geometryServiceURL:geometryServiceURL,trsURL:"https://mcgis.mesacounty.us/arcgis/rest/services/maps/eSurveyor/MapServer/12"})}function extentZoom(extentObject){var utm12=new SpatialReference({wkid:102206}),ext=extentObject.split(":"),xmin=parseInt(ext[0]),ymin=parseInt(ext[1]),xmax=parseInt(ext[2]),ymax=parseInt(ext[3]);return new Extent(xmin,ymin,xmax,ymax,utm12)}function urlMapType(url,map,legend,initialBasemap,config,device,parcels){function runQuery(layerid,field,value,service){var graphicTool=new graphicsTools({geometryServiceURL:esriConfig.defaults.geometryService,mapRef:map}),dQueryTask=new QueryTask("https://mcgis.mesacounty.us/arcgis/rest/services/maps/"+service+"/MapServer/"+layerid),dQuery=new query;dQuery.returnGeometry=!0,dQuery.outFields=[""],dQuery.where=field+" = '"+value+"'",dQueryTask.execute(dQuery,function(result){map.setExtent(map.graphics.add(new Graphic(graphicTool.createJSONPolygon(result.features[0].geometry.rings))).geometry.getExtent().expand(1.5))})}var parseParameters=function(url){var queryObject=urlUtils.urlToObject(url).query,params={};if(queryObject){Object.keys(queryObject).forEach(function(key){"cbxid"===key?params[key]=queryObject[key].split(","):"PARCEL_NUM"===key?params[key]=queryObject[key].replace(/-/g,""):key in["field","ACCOUNTNO"]?params[key]=queryObject[key].ToUpperCase():params[key]=queryObject[key]});var title=queryObject.maptype?query("#layerSelect ul li[data-value='"+queryObject.maptype+"']").children("a").innerHTML():"Select Map";params.title=title}return params},urlParams=parseParameters(url),maptypeFound=function(type){return themeTools.getTemplate(type)};registry.byId("toolsView2")&&registry.byId("toolsView2").destroyRecursive(),urlParams.maptype="Select Map"===urlParams.title?"eassessor":urlParams.maptype;var tools=new toolsWidget({geometryServiceURL:config.geometryService,printURL:config.printURL,imageList:config.imagesList,mapRef:map,basemap:initialBasemap,deviceUsed:device,popupRef:config.popupTemplate,popupTemplateRef:config.parcelTemplate,legendRef:legend,parcelLayer:parcels},"toolsView2"),components={pVal:urlParams.title,checkboxid:urlParams.cbxid};tools.dispatchThemeMenuClick(urlParams.maptype,components,!0),setTimeout(function(){void 0!==urlParams.ACCOUNTNO&&searchTools.searchBy("account",urlParams.ACCOUNTNO),void 0!==urlParams.PARCEL_NUM&&searchTools.searchBy("parcelNo",urlParams.PARCEL_NUM),void 0!==urlParams.EXTENT&&map.setExtent(extentZoom(urlParams.EXTENT)),void 0!==urlParams.latlon&&searchTools.searchBy("Latitude/Longitude",urlParams.latlon),void 0!==urlParams.field&&runQuery(urlParams.layerid,urlParams.field,urlParams.value,urlParams.service),void 0!==urlParams.maptype&&maptypeFound(urlParams.maptype)},201)}JSONconfig=JSON.parse(JSONconfig),aG.popup=1===checkForMobile()?setPopup("mobile","popup"):setPopup("static","popup");var device="esriPopupMobile"===aG.popup.domNode.className?"mobile":"desktop";esriConfig.defaults.io.proxyUrl=JSONconfig.proxyURL,esriConfig.defaults.io.alwaysUseProxy=!1,esriConfig.defaults.geometryService=new GeometryService(JSONconfig.geometryService),document.dojoClick=!1;var utm12=new SpatialReference({wkid:102206}),initExtent=setInitialExtent(utm12,device);aG.map=createMap(initExtent,aG.popup),aG.pTemp=createPopupTemplate(),lmG.pLay=createFeatureLayer("https://mcgis.mesacounty.us/arcgis/rest/services/maps/ParcelOnly4Query/MapServer/0",aG.pTemp,["LOCATION","ACCOUNTNO","OWNER","JTOWNER","SDATE","PARCEL_NUM","ZONING","Acres","JURISDICTION"]),lmG.roadLabels=createTiledMapServiceLayer("https://mcgis.mesacounty.us/image/rest/services/Mosaic_Datasets/Basemap_Labels/MapServer","roadLabels");var initialBasemap=createTiledMapServiceLayer("https://mcgis.mesacounty.us/image/rest/services/Mosaic_Datasets/Basemap_Background/MapServer","vectorBasemap");aG.map.addLayers([initialBasemap,lmG.pLay,lmG.roadLabels]),aG.map.on("load",function(){var scalebar=new Scalebar({map:aG.map,attachTo:"bottom-right"});scalebar.show(),createContextMenu(aG.map,JSONconfig.geometryService);var node=domConstruct.toDom("<div data-to='mainSideMenu' class='displayNo legendMenu' id='legendDiv'></div>");domConstruct.place(node,document.getElementById("map"),"before");var legend=new Legend({map:aG.map},node);homeButton({mapRef:aG.map}),window.addEventListener("orientationchange",orientationChanged,!1),aG.map.on("mouse-move",function(e){document.getElementById("screenCoordinatesUTM").innerHTML="X="+e.mapPoint.x.toFixed(1)+"  Y="+e.mapPoint.y.toFixed(1)}),on(dom.byId("menuSelect"),"click",function(legend){runToolsView(JSONconfig,{mapRef:aG.map,deviceUsed:device,popupRef:aG.popup,popupTemplateRef:aG.pTemp,legendRef:legend,basemap:initialBasemap,parcelLayer:lmG.pLay})}),on(dom.byId("locate"),touch.release,function(){var locate=new locatorWidget({mapRef:aG.map,gsvc:JSONconfig.geometryService,device:"desktop"});locate.startup()}),on(query(".submen li, .submenu li"),touch.release,function(e){showDropdownMenu(e,"none")}),on(query("#combobox, #mainfish"),"mouseenter, mouseleave, touchstart",function(e){showDropdownMenu(e)}),document.getElementById("loading").style.display="none",aG.map.disableKeyboardNavigation(),JSONconfig.parcelTemplate=aG.pTemp,JSONconfig.popupTemplate=aG.popup,location.href.indexOf("?")>-1?urlMapType(location.href,aG.map,legend,initialBasemap,JSONconfig,device,lmG.pLay):runToolsView(JSONconfig,{mapRef:aG.map,deviceUsed:device,popupRef:aG.popup,popupTemplateRef:aG.pTemp,legendRef:legend,basemap:initialBasemap,parcelLayer:lmG.pLay})})})}var aG={},lmG={};init();