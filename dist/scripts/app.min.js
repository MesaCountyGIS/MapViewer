function init(){aG={},lmG={},require(["esri/config","dojo/on","dojo/dom-construct","dojo/text!./scripts/_config/config.json","esri/dijit/Legend","mesa/toolsWidget2"],function(esriConfig,on,domConstruct,JSONconfig,Legend){var JSONconfig=JSON.parse(JSONconfig);aG.popup=setPopup(1===checkForMobile()?"mobile":"static");var device="esriPopupMobile"===aG.popup.domNode.className?"mobile":"desktop";esriConfig.defaults.io.proxyUrl=JSONconfig.proxyURL,esriConfig.defaults.io.alwaysUseProxy=!1,esriConfig.defaults.geometryService=createGeometryService(JSONconfig.geometryService),document.dojoClick=!1;var utm12=setSpatialRef(102206),initExtent=setInitialExtent(utm12,device);aG.map=createMap(initExtent),aG.pTemp=createPopupTemplate(),lmG.pLay=createFeatureLayer("http://mcmap2.mesacounty.us/arcgis/rest/services/maps/ParcelOnly4Query/MapServer/0",aG.pTemp,["LOCATION","ACCOUNTNO","OWNER","JTOWNER","SDATE","PARCEL_NUM","ZONING","Acres","JURISDICTION"]),lmG.roadLabels=createTiledMapServiceLayer("http://mcmap2.mesacounty.us/arcgis/rest/services/maps/parcel_road_labels/MapServer","roadLabels");var initialBasemap=createTiledMapServiceLayer("http://mcmap2.mesacounty.us/arcgis/rest/services/maps/vector_basemap/MapServer","vectorBasemap");aG.map.addLayers([initialBasemap,lmG.pLay,lmG.roadLabels]),aG.map.on("load",function(){createScalebar(aG.map),createContextMenu(aG.map,JSONconfig.geometryService);var node=domConstruct.toDom("<div data-to='mainSideMenu' class='displayNo legendMenu' id='legendDiv'></div>");domConstruct.place(node,document.getElementById("map"),"before");var legend=new Legend({map:aG.map},node);createHomeButton(aG.map),setEventHandlers(JSONconfig,aG.map,lmG.pLay,initialBasemap,lmG.roadLabels,aG.popup,aG.pTemp,legend),document.getElementById("loading").style.display="none",aG.map.disableKeyboardNavigation(),location.href.indexOf("?")>-1?urlMapType(location.href,aG.map,legend,initialBasemap,JSONconfig,device,lmG.pLay):runToolsView(JSONconfig,aG.map,device,aG.popup,aG.pTemp,legend,initialBasemap,lmG.pLay)})})}function setEventHandlers(JSONconfig,map,parcelLayerObject,initialBasemap,roadLabels,popupObject,popupTemplateObject,legendObject){require(["dojo/on","dojo/query","dojo/dom","dojo/touch","mesa/themeTools"],function(on,query,dom,touch,themeTools){window.addEventListener("orientationchange",orientationChanged,!1),map.on("mouse-move",function(e){showCoords(e,"screenCoordinatesUTM")}),on(dom.byId("menuSelect"),"click",function(legendObject){runToolsView()}),on(query("#layerSelect ul li"),touch.release,function(e){themeTools.themeClick(this,map,popupObject,popupTemplateObject,legendObject,initialBasemap)}),on(dom.byId("locate"),touch.release,function(){showLocator(JSONconfig.geometryService)}),on(query(".submen li, .submenu li"),touch.release,function(){showDropdownMenu.call(this,void 0,"none")}),on(query("#combobox, #mainfish"),"mouseenter, mouseleave, touchstart",function(e){showDropdownMenu.call(this,e)})})}function showDropdownMenu(e,display){require(["dojo/query"],function(query){void 0===display?(display="mouseleave"===e.type?"none":"block",classname="."+query("#"+this.id+" ul")[0].className):classname="."+this.parentNode.className,query(classname)[0].style.display=display}.bind(this))}function createTiledMapServiceLayer(url,id){var tile;return require(["esri/layers/ArcGISTiledMapServiceLayer"],function(ArcGISTiledMapServiceLayer){tile=new ArcGISTiledMapServiceLayer(url,{id:id})}),tile}function createFeatureLayer(url,template,fields){var service;return require(["esri/layers/FeatureLayer"],function(FeatureLayer){service=new FeatureLayer(url,{mode:FeatureLayer.MODE_ONDEMAND,infoTemplate:template,outFields:fields})}),service}function createGeometryService(serviceURL){var service;return require(["esri/tasks/GeometryService"],function(GeometryService){service=new GeometryService(serviceURL)}),service}function createPopupTemplate(){var temp;return require(["esri/dijit/PopupTemplate"],function(PopupTemplate){temp=new PopupTemplate({fieldInfos:[{fieldName:"Acres",visible:!0,format:{places:2}}],title:"<b>Parcel Information:</b>",description:"<b>Account number:</b>  <a href='http://emap.mesacounty.us/assessor_lookup/Assessor_Parcel_Report.aspx?Account={ACCOUNTNO}'target='_blank'>{ACCOUNTNO}</a><br><b>Parcel Number:</b> {PARCEL_NUM}<br><b>Owner:</b>  {OWNER}<br><b>Joint Owner:</b>  {JTOWNER}<br><b>Address:</b>{LOCATION}<br><b>Sale Date:</b> {SDATE}<br><b>Zoning:</b> {ZONING}<br><b>Approximate Acres:</b> {Acres}<br><b>Jurisdiction: </b>{JURISDICTION}<br><div id='mapButtons'><a title='Click to view parcel in Google Earth' class='maplink' target='_blank' href='http://emap.mesacounty.us/kmls?acct={ACCOUNTNO}'>Google Earth</a><a title='Click to view parcel in Bing Maps' class='maplink' target='_blank' href='http://www.bing.com/maps/?mapurl=http://emap.mesacounty.us/kmls?acct={ACCOUNTNO}'>Bing Maps</a></div><br>"})}),temp}function createMap(initExtent){var map;return require(["esri/map"],function(Map){map=new Map("map",{extent:initExtent,logo:!1,infoWindow:aG.popup})}),map}function setInitialExtent(spatialRef,device){var ext,xmin="mobile"===device?697373:685960,ymin="mobile"===device?4322305:4316261,xmax="mobile"===device?726312:738288,ymax="mobile"===device?4335072:4342506;return require(["esri/geometry/Extent"],function(Extent){ext=new Extent({xmin:xmin,ymin:ymin,xmax:xmax,ymax:ymax,spatialReference:spatialRef})}),ext}function setSpatialRef(wkid){var ref;return require(["esri/SpatialReference"],function(SpatialReference){ref=new SpatialReference({wkid:wkid})}),ref}function setPopup(type){var pop;return"mobile"===type?require(["dojo/dom","esri/dijit/PopupMobile"],function(dom,PopupMobile){pop=PopupMobile(null,dom.byId("popup"))}):require(["esri/dijit/Popup"],function(Popup){pop=Popup({titleInBody:!1},document.getElementById("popup"))}),pop}function checkForMobile(){var isMobile;return require(["dojo/has","dojo/sniff"],function(has,sniff){has.add("mobile",function(global,document,anElement){return has("ie")?void require(["libs/matchMedia"],function(){return!(!window.matchMedia("only screen and (max-width: 1024px)").matches||!has("touch"))}):!(!window.matchMedia("only screen and (max-width: 1024px)").matches||!has("touch"))}),isMobile=has("mobile")?1:0}),isMobile}function runToolsView(config,map,device,popupObject,popupTemplateObject,legendObj,initialBasemap,parcels){require(["dijit/registry","mesa/toolsWidget2"],function(registry,toolsWidget){if(registry.byId("toolsView2"))"block"===registry.byId("toolsView2").domNode.style.display?registry.byId("toolsView2").domNode.style.display="none":registry.byId("toolsView2").domNode.style.display="block";else{new toolsWidget({geometryServiceURL:config.geometryService,printURL:config.printURL,imageList:config.imagesList,mapRef:map,basemap:initialBasemap,deviceUsed:device,popupRef:popupObject,popupTemplateRef:popupTemplateObject,legendRef:legendObj,parcelLayer:parcels},"toolsView2");registry.byId("toolsView2").domNode.style.display="none"}})}function orientationChanged(){require(["dojo/query"],function(query){query(".expandedPanel")[0]&&(query(".expandedPanel")[0].style.display="none")})}function createHomeButton(map){require(["mesa/homeButton"],function(homeButton){homeButton({mapRef:map})})}function createContextMenu(map,geometryServiceConfig){require(["mesa/contextMenuWidget"],function(contextMenuWidget){contextMenuWidget({mapRef:map,geometryServiceURL:geometryServiceConfig,trsURL:"http://mcmap2.mesacounty.us/arcgis/rest/services/maps/eSurveyor/MapServer/26"})})}function createScalebar(map){require(["esri/dijit/Scalebar"],function(Scalebar){new Scalebar({map:map,attachTo:"bottom-right",scalebarUnit:"dual"})})}function showLocator(geometryServiceURL){require(["mesa/locatorWidget","dojo/dom","dojo/on","dijit/registry"],function(locatorWidget,dom,on,registry){var locate=new locatorWidget({mapRef:aG.map,gsvc:geometryServiceURL,device:"desktop"});locate.startup()})}function showCoords(evt,id){document.getElementById(id).innerHTML="X="+evt.mapPoint.x.toFixed(1)+"  Y="+evt.mapPoint.y.toFixed(1)}function extentZoom(extentObject){var viewExtent;return require(["esri/geometry/Extent","esri/SpatialReference"],function(Extent,SpatialReference){var utm12=new SpatialReference({wkid:102206}),ext=extentObject.split(":"),xmini=parseInt(ext[0]),ymini=parseInt(ext[1]),xmaxi=parseInt(ext[2]),ymaxi=parseInt(ext[3]);viewExtent=new Extent({xmin:xmini,ymin:ymini,xmax:xmaxi,ymax:ymaxi,spatialReference:utm12})}),viewExtent}function urlMapType(url,map,legend,initialBasemap,config,device,parcels){require(["esri/urlUtils","dojo/query","dojo/NodeList-traverse","dojo/dom-attr","dojo/_base/array","dojo/NodeList-manipulate","mesa/searchTools"],function(urlUtils,query,domAttr,array,searchTools){function parseParameters(url){function createTitle(map_type){return query("#layerSelect ul li[data-value='"+map_type+"']").children("a").innerHTML()}function maptypeFound(type){return require(["mesa/themeTools"],function(themeTools){themeTools.getTemplate(type)}),type}function runQuery(layerid,field,value){require(["esri/tasks/QueryTask","esri/tasks/query","esri/graphic","mesa/graphicsTools"],function(QueryTask,Query,Graphic,graphicsTools){var graphicTool=new graphicsTools({geometryServiceURL:esriConfig.defaults.geometryService,mapRef:map});dQueryTask=new QueryTask("http://mcmap2.mesacounty.us/arcgis/rest/services/maps/"+service+"/MapServer/"+layerid),dQuery=new Query,dQuery.returnGeometry=!0,dQuery.outFields=[""],dQuery.where=field+" = '"+value+"'",dQueryTask.execute(dQuery,function(result){map.setExtent(map.graphics.add(new Graphic(graphicTool.createJSONPolygon(result.features[0].geometry.rings))).geometry.getExtent().expand(1.5))})})}var queryObject=urlUtils.urlToObject(url).query;if(queryObject){var maptype=queryObject.maptype?maptypeFound(queryObject.maptype.toLowerCase()):void 0,title=queryObject.maptype?createTitle(maptype):"Select Map",layerid=queryObject.layerid?queryObject.layerid:void 0,checkboxid=queryObject.cbxid?queryObject.cbxid.toLowerCase().split(","):void 0,field=queryObject.field?String(queryObject.field).toUpperCase():void 0,value=queryObject.value?queryObject.value:void 0,service=queryObject.service?queryObject.service:void 0,coordinates=queryObject.latlon?queryObject.latlon:void 0,accountNumber=queryObject.ACCOUNTNO?queryObject.ACCOUNTNO.toUpperCase():void 0,parcelNumber=queryObject.PARCEL_NUM?queryObject.PARCEL_NUM.replace(/-/g,""):void 0,extent=queryObject.EXTENT?queryObject.EXTENT.toUpperCase():void 0,params=[maptype,title,layerid,value,checkboxid];void 0!==coordinates&&searchTools.searchBy("Latitude/Longitude",coordinates),void 0!==field&&runQuery(layerid,field,value),void 0!==accountNumber&&searchTools.searchBy("account",accountNumber),void 0!==parcelNumber&&searchTools.searchBy("parcelNo",parcelNumber),void 0!==extent&&map.setExtent(extentZoom(extent))}return params}var urlParams=parseParameters(url);"Select Map"!==urlParams[1]&&require(["dijit/registry","mesa/toolsWidget2"],function(registry,toolsWidget){var components={pVal:urlParams[3],checkboxid:urlParams[4]};registry.byId("toolsView2")&&registry.byId("toolsView2").destroyRecursive();var tools=new toolsWidget({geometryServiceURL:config.geometryService,printURL:config.printURL,imageList:config.imagesList,mapRef:map,basemap:initialBasemap,deviceUsed:device,popupRef:aG.popup,popupTemplateRef:aG.pTemp,legendRef:legend,parcelLayer:parcels},"toolsView2");tools.dispatchThemeMenuClick(urlParams[0],components)})})}init();