define(["dojo/_base/array","dojo/dom-construct","dojo/dom-attr","dojo/dom","dojo/query","dojo/dom-class","dojo/dom-style","mesa/changeTheme"],function(array,domConstruct,domAttr,dom,query,domClass,domStyle,changeTheme){function _themeClick(e,self,map,popupObject,popupTemplateObject,legend,initialBasemap,components){var newLayer=self.attributes["data-value"].nodeValue;if(_getTemplate(newLayer),"epom"!==newLayer&&newLayer.length>0){var layerTitle=self.getElementsByTagName("a")[0].innerHTML,option=self.attributes["data-opt"]?self.attributes["data-opt"].nodeValue:null;setTimeout(function(){new changeTheme({newLayer:newLayer,layerTitle:layerTitle,option:option,pVal:null,mapRef:map,basemapRef:initialBasemap,infoWindowRef:popupObject,infoTemplateRef:popupTemplateObject,checkboxid:null,mapLegend:legend}).then(_animatePanel(e))},200)}}function _getTemplate(newLayerName){var templateName="dojo/text!./scripts/esri/mesa/templates/"+newLayerName+"Select.html";document.getElementById(newLayerName+"Select")||require([templateName],function(template){domConstruct.place(template,"noControl","before")})}function _animatePanel(e){if("open"===e)dom.byId("hidePanel").innerHTML="hide",dom.byId("noControl").style.display="block",domClass.replace(dom.byId("rightPanel"),"expandedPanel","collapsedPanel"),domClass.add("noControl","someControl");else{var parentcls=domAttr.get(e.target.parentNode,"class");if(query(".select").every(function(node){return"none"===domStyle.get(node,"display")})?domClass.remove("noControl","someControl"):domClass.add("noControl","someControl"),"click"===e.type&&"collapsedPanel"===parentcls)dom.byId("hidePanel").innerHTML="hide",domClass.replace(dom.byId("rightPanel"),"expandedPanel","collapsedPanel");else if("click"===e.type&&"expandedPanel"===parentcls)dom.byId("hidePanel").innerHTML="Layers",domClass.replace(dom.byId("rightPanel"),"collapsedPanel","expandedPanel");else{if("A"!==e.target.nodeName&&"LI"!==e.target.nodeName)return;dom.byId("hidePanel").innerHTML="hide",domClass.replace(dom.byId("rightPanel"),"expandedPanel","collapsedPanel")}}}return{themeClick:_themeClick,getTemplate:_getTemplate,animatePanel:_animatePanel}});